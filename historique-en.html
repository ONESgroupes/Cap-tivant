<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Historique</title>
    <link rel="stylesheet" href="PageAccueil.css">
    <link rel="stylesheet" href="historique.css">
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">
</head>
<body style="background-color: #c5d8d3;">

<!-- Menu hamburger -->
<div class="top-left" onclick="toggleMenu()">
    <img src="/images/menu-vert.png" alt="Menu">
</div>

<!-- Menu overlay -->
<div id="menu-overlay" class="menu-overlay">
    <div class="menu-content">
        <a href="location-en.html">RENT</a>
        <a href="ports-en.html">OUR HARBOUR</a>
        <a href="MonCompte-en.html">MY ACCOUNT</a>
        <a href="historique-en.html">HISTORY</a>
        <a href="faq-en.html">FAQ</a>
        <a href="avis-en.html">OPINION</a>
        <span onclick="toggleMenu()" class="close-menu">✕</span>
    </div>
</div>

<!-- Logo et titre -->
<div class="top-center">
    <div class="logo-block">
        <a href="PageAccueil.html">
            <img src="/images/logo-transparent.png" alt="Logo" style="width: 30px;">
        </a>
        <p class="logo-slogan">Cap'Tivant</p>
        <h1 class="page-title">History</h1>
    </div>
</div>

<!-- Lien langue / compte -->
<div class="top-right">
    <div class="language-selector">
        <img id="current-lang" src="/images/drapeau-francais.png" alt="Langue" onclick="toggleLangDropdown()" class="drapeau-icon">
        <div id="lang-dropdown" class="lang-dropdown">
            <img id="fr-option" src="/images/drapeau-francais.png" alt="Français" class="drapeau-option" onclick="changerLangue('fr')">
            <img id="en-option" src="/images/drapeau-anglais.png" alt="Anglais" class="drapeau-option" onclick="changerLangue('en')">
        </div>
    </div>
    <a href="a-propos-en.html" style="color: #577550; text-decoration: none;">About</a>
    <a href="Connexion-en.html" style="color: #577550; text-decoration: none;">My account</a>
    <a href="favoris-en.html">
        <img src="/images/panier.png" alt="panier">
    </a>
</div>

<!-- Contenu central -->
<div id="historique-container" class="historique-container">
    <!-- Contenu généré par JavaScript -->
</div>

<!-- Pied de page -->
<footer class="bouton-bas">
    <button onclick="viderHistorique()" class="btn-vider-historique">Empty History</button>
    <a href="MentionsLegales-en.html" class="bottom-text" style="color: #577550;">Legal Notice</a>
    <span class="bottom-text" style="color: #577550;">•</span>
    <a href="Contact-en.html" class="bottom-text" style="color: #577550;">Contact</a>
</footer>


<!-- Script menu -->
<script>
    function toggleMenu() {
        const menu = document.getElementById("menu-overlay");
        menu.classList.toggle("active");
    }
</script>
<script>
    function toggleMenu() {
        const menu = document.getElementById("menu-overlay");
        menu.classList.toggle("active");
    }

    function toggleLangDropdown() {
        const dropdown = document.getElementById("lang-dropdown");
        dropdown.style.display = (dropdown.style.display === "block") ? "none" : "block";
    }

    function changerLangue(langue) {
        if (langue === 'fr') {
            window.location.href = "historique.html";
        } else if (langue === 'en') {
            window.location.href = "historique-en.html";
        }
    }

    window.onload = function () {
        const currentLang = document.getElementById("current-lang");
        const langDropdown = document.getElementById("lang-dropdown");

        // Affiche uniquement le drapeau opposé dans le dropdown
        if (window.location.href.includes("-en")) {
            currentLang.src = "/images/drapeau-anglais.png";
            langDropdown.innerHTML = `<img src="/images/drapeau-francais.png" alt="Français" class="drapeau-option" onclick="changerLangue('fr')">`;
        } else {
            currentLang.src = "/images/drapeau-francais.png";
            langDropdown.innerHTML = `<img src="/images/drapeau-anglais.png" alt="Anglais" class="drapeau-option" onclick="changerLangue('en')">`;
        }
    };

    // Fermer le menu langue si on clique ailleurs
    document.addEventListener("click", function(event) {
        const dropdown = document.getElementById("lang-dropdown");
        const icon = document.getElementById("current-lang");
        if (!dropdown.contains(event.target) && !icon.contains(event.target)) {
            dropdown.style.display = "none";
        }
    });
</script>

<!-- Script pour afficher l'historique -->
<script>
    const historique = JSON.parse(localStorage.getItem("historique") || "[]");
    const container = document.getElementById("historique-container");

    if (historique.length === 0) {
        container.innerHTML = "<p style='text-align:center;'>No reservations recorded yet.</p>";
    } else {
        historique.forEach(bateau => {
            container.innerHTML += `
                <div class="historique-card">
                    <h2>${bateau.titre}</h2>
                    <p><strong>Harbour :</strong> ${bateau.port}</p>
                    <p><strong>People :</strong> ${bateau.personnes}</p>
                    <p><strong>Cabins :</strong> ${bateau.cabines}</p>
                    <p><strong>Length :</strong> ${bateau.longueur}</p>
                    <p><strong>Price :</strong> ${bateau.prix}</p>
                    <img src="${bateau.image1}" alt="${bateau.titre}">
                    <button onclick="laisserAvis('${bateau.titre}')">Leave a review</button>
                </div>
            `;
        });
    }

    function laisserAvis(titreBateau) {
        const avisExistants = JSON.parse(localStorage.getItem("avis") || "[]");

        // Vérifie si un avis existe déjà pour ce bateau
        const dejaCommente = avisExistants.some(a => a.titre === titreBateau);
        if (dejaCommente) {
            alert("You have already left a review for this boat.");
            return;
        }

        const popup = document.createElement("div");
        popup.className = "avis-popup-overlay";
        popup.innerHTML = `
        <div class="avis-popup-bulle">
            <h2>Merci pour votre réservation !</h2>
            <p>Laissez-nous un avis sur votre expérience :</p>
            <textarea id="commentaire" placeholder="Your comment..."></textarea><br><br>
            <label>Note :</label>
            <select id="etoiles">
                <option value="1">⭐</option>
                <option value="2">⭐⭐</option>
                <option value="3">⭐⭐⭐</option>
                <option value="4">⭐⭐⭐⭐</option>
                <option value="5">⭐⭐⭐⭐⭐</option>
            </select><br><br>
            <button onclick="validerAvis('${titreBateau}')">Validate the notice</button>
            <button onclick="fermerAvisPopup()">Close</button>
        </div>
    `;
        document.body.appendChild(popup);
    }


    function validerAvis(titreBateau) {
        const commentaire = document.getElementById("commentaire").value.trim();
        const etoiles = parseInt(document.getElementById("etoiles").value);

        if (!commentaire || isNaN(etoiles)) {
            alert("Please fill in all fields.");
            return;
        }

        const avis = JSON.parse(localStorage.getItem("avis") || "[]");
        avis.push({
            titre: titreBateau,
            commentaire: commentaire,
            etoiles: etoiles,
            date: new Date().toLocaleDateString()
        });

        localStorage.setItem("avis", JSON.stringify(avis));
        alert("Thank you! Your review has been recorded.");
        fermerAvisPopup();
    }

    function fermerAvisPopup() {
        const popup = document.querySelector(".avis-popup-overlay");
        if (popup) popup.remove();
    }
</script>

<script>
    function viderHistorique() {
        if (confirm("Are you sure you want to delete all history?")) {
            localStorage.removeItem("historique");
            location.reload(); // recharge la page pour mettre à jour l'affichage
        }
    }
</script>


</body>
</html>
